# Launch VM w/ GPU (3.67/hr)
# Standard_NC24ads_A100_v4  24 vCPUS      220 RAM
# https://docs.skypilot.co/en/latest/examples/interactive-development.html#dev-vscode

resources:
# NOTE: had to request quota increase from 0 and got approved for westus3...
  infra: azure/westus3
  accelerators: 'A100-80GB:1'
  # Automatically *stop* the cluster after being idle for N minutes (don't delete)
  autostop:
    idle_minutes: 10
    down: false  # just stop don't delete.

# Sync code from GitHub repo to VM $PWD
workdir:
  url: https://github.com/DSHydro/NeuralHydrologyAzure.git
  ref: main

# Setup Pixi for Venv management
setup: |
  curl -fsSL https://pixi.sh/install.sh | sh
  source ~/.bashrc
  pixi --version
  nvidia-smi

# Initialize environment and confirm GPU access
run: |
  pixi run -e gpu python -c "import torch; print(torch.cuda.is_available())"
